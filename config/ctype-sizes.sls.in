#!r6rs

(library (sbank config ctype-sizes)
  (export ctype-sizeof ctype-alignof)
  (import (rnrs base))

  (define (ctype-sizeof sym)
    (let ((size
           (case sym
             ((char uchar)    1)
             ((short ushort)  @SIZEOF_SHORT@)
             ((int uint)      @SIZEOF_INT@)
             ((long ulong)    @SIZEOF_LONG@)
             ((llong ullong)  @SIZEOF_LONG_LONG@)
             ((pointer)       @SIZEOF_POINTER@)
             ((size_t)        @SIZEOF_SIZE_T@)
             (else #f))))
      (or size
          (error 'ctype-sizeof "size of type unknown" sym))))

  (define ctype-alignof
    (let ((target '(@TARGET_CPU@ @TARGET_OS@)))
      (cond
       ((equal? target '(x86_64 linux-gnu))
        (lambda (sym)
          (case sym
            ((int8 uint8)   1)
            ((int16 uint16) 2)
            ((int32 uint32) 4)
            ((int64 uint64) 8)
            (else           (ctype-sizeof sym)))))
       (else
        (error 'ctype-alignment "unknown target" target))))))
